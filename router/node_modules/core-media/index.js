/**
 * @date 10/02/2016
 * @author DangTM
 * @desciption handle media
 * 
 */
/**
 * Important: install ffmpeg before run this file: 
 * apt install ffmpeg
 * npm install node-ffprobe -s
 */
var probe = require('node-ffprobe'); 
var fs = require('fs');
var Media = function(){	
}
Media.prototype.getInfoMedia = function(req, res, path){
	var fileName = path;
	var ext = fileName.split('/').pop().toLowerCase();
	if(ext.indexOf('.html') > 0 || ext.indexOf('.jpg') > 0 || ext.indexOf('.png') > 0 || ext.indexOf('.jpeg') > 0){
		res.status(200).send(JSON.stringify({success:1, message: 'upload successfully'}));
   }
   if(fs.existsSync(fileName)){
	   probe(fileName, function(err, probeData) {
	       if(err){
	           console.log(err);
	        }
	       console.log(probeData);
	       var json = {success: 1, duration: probeData.format.duration, 
	    		   		resolution:{width:probeData.streams[0].coded_width, height:probeData.streams[0].coded_height}};
	       res.status(200).send(JSON.stringify(json));
	   });

   } else {
 	var err = {error: 404, message: 'File not exist'};
     res.send(JSON.stringify(err));
   }
   
}
module.exports = new Media();